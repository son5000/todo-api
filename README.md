# todo-api ( express/ mongoose <> mongoDB) ğŸ’¡

<aside>

**2024-11-01  !**

</aside>

## ì£¼ìš” ì‚¬ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ìµìŠ¤í…ì…˜

[ mongoDB ](https://www.notion.so/1-mongoDB-134b853ac11a8064ad3befc68df86327?pvs=21)

[ mongoose ](https://www.notion.so/2-mongoose-134b853ac11a8095aec1c8c093418413?pvs=21)

[ nodemon ](https://www.notion.so/3-nodemon-134b853ac11a8087873bcd256e706fde?pvs=21)

[ REST Client ](https://www.notion.so/4-REST-Client-134b853ac11a80e2892bc59f638d5a24?pvs=21)










<aside>

</aside>

**ğŸ’¡ê°œë°œê³µë¶€ ê³¼ì •!**

## 1 express ë¡œ ë¼ìš°íŠ¸ ìƒì„±.

express ë¡œ ë¼ìš°íŠ¸ë¥¼ ìƒì„± â‡’ ì—¬ê¸°ì„œ ë¼ìš°íŠ¸ë€ íŠ¹ì • â€˜ì—”íŠ¸í¬ì¸íŠ¸â€™ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì½”ë“œ.

ì½”ë“œ ì˜ˆì‹œ) express ë¡œ HTTP ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ì ì¸ ëª¨ìŠµ.

const app = express ();

```jsx
app.get(â€™/helloâ€™ , (req ,res ) â‡’ { 
		 res.sed('Hi')
} 
app.listen(3000 , () => console.log('ì„œë²„ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤')

ì—¬ê¸°ì„œ listen í•¨ìˆ˜ëŠ” ì„œë²„ì˜ 3000ë²ˆ í¬íŠ¸ë¥¼ ê°€ë¦¬í‚¤ê² ë‹¤? ë“£ê³  ìˆë‹¤ ? ì •ë„ë¡œ ì´í•´í•˜ê³ 
ì„œë²„ë¥¼ ì‹œì‘í•˜ë©´ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤. 
```

### ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ë•ŒëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´í˜•ì‹ì„ jsoní˜•ì‹ìœ¼ë¡œâ€¦

res.send() ë©”ì†Œë“œëŠ” ì•„ê·œë¨¼íŠ¸ë¡œ JS ê°ì²´ë¥¼ ë°›ìœ¼ë©´ ê·¸ê²ƒì„ Json  í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•´ì„œ ì „ë‹¬í•œë‹¤.

ë°˜ëŒ€ë¡œ ì„œë²„ì—ì „ë‹¬í•˜ëŠ” ìƒí™©ì´ ì•„ë‹Œ ë°›ì„ë•ŒëŠ” ì§ì ‘ íŒŒì‹±ì„ í•´ì•¼í•œë‹¤.

ì„ ì–¸í•œ express ë¼ìš°íŠ¸ ê°ì²´ì— use(express.json( ) ) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì „ë‹¬ ë°›ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼

json â‡’ js ê°ì²´íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ì„œ ë°›ëŠ”ë‹¤.

## ì¿¼ë¦¬ìŠ¤íŠ¸ë§

ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì€ url ì—ì„œ ? ë‹¤ìŒì— ì˜¤ëŠ” ë¶€ë¶„ì´ë‹¤.

ë³´í†µ get ë©”ì†Œë“œë¥¼ ë°ì´í„°ë¥¼ ìš”ì²­í• ë•Œ ë°ì´í„°ë¥¼ íŠ¹ì •í•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ ë¶„ë¥˜í• ë•Œ ì¡°ê±´ì„ ì „ë‹¬í•˜ëŠ”ë°

ì‚¬ìš©í•œë‹¤.

ex ) /hello?sort=oldest&count=3  ì´ì²˜ëŸ¼ ì •ë ¬ê³¼ ë°›ì•„ì˜¬ ë°ì´í„°ì˜ ê°¯ìˆ˜ë“±ì„ ì„¤ì •í•œë‹¤.

ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì€  req.qurey  ê°ì²´ì˜ keyì™€ ê°’ì´ ëœë‹¤.

ex ) req.qurey.sort , req.qurey.count 

ì´ë•Œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ëŠ” ë¬´ì¡°ê±´ ë¬¸ìì—´ì„ ë¦¬í„´í•œë‹¤.

count ì²˜ëŸ¼ ë¬´ì—‡ì¸ê°€ ìˆ«ìì˜ ê°’ì´ í•„ìš”í•˜ë‹¤ë©´ Number () ë¥¼ í™œìš©í•´ì„œ ë³€ìˆ˜ì˜ íƒ€ì…ì„ ë°”ê¿”ì£¼ì.

ì‚¬ìš©ì˜ˆì‹œ ì½”ë“œ â‡’  

```
ì˜ˆì‹œ í˜¸ì¶œ ë¬¸.  sort = oldest count = 3
GET http://localhost:3000/tasks?sort=oldest&count=3
```

```jsx
const app = express();

app.use(express.json());

app.get('/tasks' , (req , res) => {
    
    const sort = req.query.sort;
    const count = Number(req.query.count);

    const compare = sort === 'oldest' ? (a , b) => a.createdAt - b.createdAt : (a , b) => b.createdAt - a.createdAt;
    let newTasks =   mockTasks.sort(compare);
    console.log(sort,count);
    if(count){
       newTasks =  newTasks.slice(0,count);
    }
    res.send(newTasks);
    })
```

### ë‹¤ì´ë‚˜ë¯¹ URL

url ì´ í•­ìƒ ì¼ì •í•˜ì§€ì•Šê³  ì¼ë¶€ê°€ ë°”ë€ŒëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

ì˜ˆë¥¼ë“¤ë©´ ì•„ì´ë”” ê°’ìœ¼ë¡œ íŠ¹ì • ë°ì´í„° í•œê°œë¥¼ ì¡°íšŒ í•œë‹¤ê³  ì³¤ì„ë•Œ , â‡’ 

id ê°’ë§ˆë‹¤  ë¼ìš°íŠ¸ë¥¼ ì •ì˜ í•  ìˆ˜ ì—†ìœ¼ë‹ˆ /hello/:id ì´ëŸ°ì‹ìœ¼ë¡œ  í¬ê´„ì ìœ¼ë¡œ ë°›ëŠ”ë‹¤.

**: id**  ( ì´ë¶€ë¶„ì€  url   íŒŒë¼ë¯¸í„°ë¼ê³  ë¶€ë¥¸ë‹¤.)

ë‹¤ì´ë‚˜ë¯¹í•˜ê²Œ ë°”ë€ŒëŠ” ë¶€ë¶„ì€ /: ì½œë¡ ë‹¤ìŒì— í‘œì‹œí•œë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ url íŒŒë¼ë¯¸í„°ë„ ë¬¸ìì—´ë¡œ ì „ë‹¬ë˜ê¸° ë•Œë¬¸ì—  Number ë¡œ ë°”ê¿”ì¤€ë‹¤.

```jsx
ex) app.get(â€™/tasks/:id â€˜ , ( req ,res ) â‡’ { 
const id = Number(req.params.id)
}
```

## mongoose schema(ìŠ¤í‚¤ë§ˆ) ì •ì˜ í•˜ê¸°

ë°ì´í„°ì˜ ëª¨ì–‘, í‹€ì„ ëª¨ë¸ë§ì„ í•˜ëŠ” ê²ƒì´ë‹¤. (ë°ì´í„° í•„ë“œì •ì˜ ë“±ë“±..)

ëª½êµ¬ìŠ¤ë¥¼ ì„í¬íŠ¸ê°€  shemaë¥¼ ì •ì˜í•´ì¤€ë‹¤. new mongoose.Schema( ) ;

í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìë¡œ ë°ì´í„°ì˜ ìœ í˜•ì„ ì •ì˜í•˜ê³  

**ë‘ ë²ˆì§¸ ì•„ê·œë¨¼íŠ¸ì—ëŠ” Schema option (ìŠ¤í‚¤ë§ˆì˜µì…˜) ì´ ë“¤ì–´ê°„ë‹¤.**

**ë‹¤ìŒì½”ë“œì—ì„œ timestamps : true ëŠ”** 

**ê°ì²´ê°€ ìƒì„±í•˜ëŠ” ì‹œê°„(createdAt,updatedAt) í”„ë¡œí¼í‹°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„± í•´ì¤€ë‹¤.**

### Schema()

schema í•¨ìˆ˜ëŠ” â‡’ ë‹¤ë£° ê°ì²´ì˜ í‹€ì„ ì •ì˜

```jsx
import mongoose from 'mongoose'
const TaskSchema = new mongoose.Schema(
	{
		title: {
			type:String,
		},
		description: {
			type :String,
			defalut : false,
		},
	  isComplete : {
    type : Boolean,
    default : false,
	},
	{
	timestamps : true ,
	},
);

const Task = mongoose.model('Task' , TaskSchema);
```

### model  ( ) ;

model ( ) ì€ schema  ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì¡°íšŒí•˜ê³  ìˆ˜ì •í•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆëŠ” 

ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.

ì²«ë²ˆì§¸ ì•„ê·œë¨¼íŠ¸ëŠ” **ì²«ë¬¸ìë¥¼ ëŒ€ë¬¸ìë¡œ ë‹¨ìˆ˜í˜•ìœ¼ë¡œ** mongoDbì—ì„œ ë‹¤ë£° ì»¬ë ‰ì…˜ì´ë¦„ì„ ê²°ì • ì§“ëŠ”ë‹¤.

ë‘ ë²ˆì§¸ ì•„ê·œë¨¼íŠ¸ì—ëŠ” ë¯¸ë¦¬ ì •ì˜í•´ë‘” **schema ê°€ ë“¤ì–´ê°„ë‹¤.**

## seed.js

ë°ì´í„°ì˜ ì´ˆê¸°ë°ì´í„°ë¥¼ ë„£ëŠ” ê³¼ì •ì„ ì‹œë”© , ì‹œë“œë°ì´í„°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš© í•  ì´ˆê¸° ë°ì´í„°ì´ë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì˜ ì´ˆê¸°ë°ì´í„°ê°€ ë“¤ì–´ê°ˆ ì´ˆê¸°ë°ì´í„°ê°€ ìˆì–´ì•¼  api ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ 

**í™•ì¸í•˜ê¸° ì¢‹ë‹¤.**

ë°ì´í„° ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ì½”ë“œ 

```jsx
mongoose.connect(DATABASE_URL);
```

ëª½êµ¬ìŠ¤ì˜  api  ëŠ” ê±°ì˜ ë‹¤ìŒê³¼ ê°™ì€ ëª¨ì–‘ì´ë‹¤. 

DB ì˜ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê³  ì“°ëŠ” ê³¼ì •ì€ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— await ë¬¸ì„ ì‚¬ìš©í•œë‹¤.

await Task.deleteMany( { } );  ëª¨ë¸.í•¨ìˆ˜ ~

**deleteMany( { } ) í•¨ìˆ˜ëŠ” ì‚­ì œì¡°ê±´ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìœ¼ë©° ë¹ˆê°ì²´ë¥¼ ì „ë‹¬í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë¨.**

**insertMany ( ) ëŠ” ì‚½ì…í•  ë°ì´í„°ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ë‹¤.**

ë°ì´í„° ë² ì´ìŠ¤ì™€ì˜ ì»¤ë„¥ì…˜ ì¢…ë£Œ â‡’ 

ì„œë²„í”„ë¡œê·¸ë¨ì€ ê³„ì† ì‹¤í–‰ëœ ìƒíƒœë¡œ ë„ì›Œë†“ê¸° ë•Œë¬¸ì— ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•  í•„ìš”ê°€ì—†ì§€ë§Œ

ì´ì½”ë“œëŠ” í•œë²ˆ ì­‰ ì‹¤í–‰ë˜ê³  ëë‚˜ëŠ” í”„ë¡œê·¸ë¨ì´ê¸° ë•Œë¬¸ì— ì¢…ë£Œë¬¸ì„ ì‘ì„±í•´ì¤€ë‹¤.

ì´ˆê¸° ì„¸íŒ…ì„ í•´ì£¼ê³  ê·¸ ì‘ì—…ì´ ëë‚˜ë©´ ì¢…ë£Œí•´ì£¼ëŠ” ëŠë‚Œ.

```jsx
import mongoose from "mongoose";
import data from './data/mock.js'
import Task from "./models/Task.js"
import { DATABASE_URL } from "./env.js";
mongoose.connect(DATABASE_URL);

await Task.deleteMany({});
await Task.insertMany(data);

mongoose.connection.close();
```

## ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ì¡°íšŒí•˜ê¸°

**ê°€ì¥ì¤‘ìš”í•œ ì ! mongoose ì—ì„œëŠ” ì¡°íšŒí•  í•„í„°ì¡°ê±´ì„ ì—°ê²°í•´ì„œ ì“°ê³ ** 

**ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•œë‹¤.**

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì½ëŠ” ì‘ì—…ì€ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ â‡’ async , await

model ë¡œ ì •ì˜í•œ Taskë¥¼ ì„í¬íŠ¸í•˜ì—¬ Task ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ìƒì„± ìˆ˜ì • ì œê±° ë“±ì„ í•œë‹¤.

**Task.findById(Id) â‡’ model.findById ëŠ” ì¿¼ë¦¬ë¥¼ ë¦¬í„´í•œë‹¤.**

ì¿¼ë¦¬ëŠ” promise ì™€ ë¹„ìŠ·í•˜ë‹¤. â‡’ ì¿¼ë¦¬ë„ ë˜‘ê°™ì´ ì‘ë™í•œë‹¤ .

ì¡°íšŒ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ì¡°íšŒí•œ ë°ì´í„°ë¥¼ ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ê²Œë˜ê³  await ìœ¼ë¡œ ê²°ê³¼ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

ì°¨ì´ì ì€ ì¿¼ë¦¬ëŠ” ì¿¼ë¦¬ë’¤ì— ì¡°íšŒ ì¡°ê±´ì„ ë‚˜ì—´í•´ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```jsx
const tasks = await Task.find().sort(sortOption).limit(count);
```

ë‹¤ìŒì½”ë“œëŠ” mongoose ì—ì„œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ë¡œ ì´ì „ì½”ë“œë¥¼ ë³€í™˜í•œ ì½”ë“œì´ë‹¤. 

ë‹¤ìŒì½”ë“œì—ì„œ ë‚˜ì˜¤ëŠ” sort í•¨ìˆ˜ëŠ” js ê¸°ë³¸ë‚´ì¥ sort í•¨ìˆ˜ì™€ëŠ” ë‹¤ë¥¸

mongoose ì—ì„œ ì œê³µí•˜ëŠ” sort í•¨ìˆ˜ì´ë‹¤. ( ì‚¬ìš©ë²•ë„ ì¡°ê¸ˆ ë‹¤ë¦„ )

**`.limit(count)`**:
`count`ì— ì§€ì •ëœ ìˆ«ìë§Œí¼ì˜ ê²°ê³¼ë§Œ ë°˜í™˜í•˜ë„ë¡ ì œí•œí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `count`ê°€ `5`ë¼ë©´, ìµœëŒ€ 5ê°œì˜ `Task` ë¬¸ì„œë§Œ ë°˜í™˜ë©ë‹ˆë‹¤.

```jsx
app.get('/tasks' , async (req , res) => {
    
    const sort = req.query.sort;
    const count = Number(req.query.count) || 0;
    const sortOption = {created : sort === 'oldest' ? 'asc' : 'desc'};
    const tasks = await Task.find().sort(sortOption).limit(count);
    res.send(tasks);
})

app.get('/tasks/:id' , async (req , res) => {
    const id = req.params.id;
    const task = await Task.findById(id);
    if(task){
        res.status(200).send(task);
    }else{
        res.status(404).send({message:'cannot found given id task'})
    }
} )
```

## mongoose ë¥¼ ì´ìš”í•œ ë°ì´í„° ìƒì„±

ëª¨ë¸í•¨ìˆ˜ create ë¥¼ ì‚¬ìš©í•˜ê³  ì•„ê·œë¨¼íŠ¸ì— req.body  ë¥¼ ì „ë‹¬í•œë‹¤.

mongoose schema ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡œí¼í‹°ê°’ì´ ìë™ìœ¼ë¡œ ì„¤ì • ë˜ê³  ê°ì²´ê°€ ìƒì„±ëœë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ req.body  ë¡œ ì „ë‹¬ëœ ë°ì´í„°ë§Œì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.

**Model.create( )**

```jsx
app.post('/tasks' , async ( req ,res) => {
    const newTask = await Task.create(req.body);
    res.status(201).send(newTask);
    
})
```

### schema ë¥¼ í†µí•œ ìœ íš¨ì„± ê²€ì‚¬.

í•„ë“œì— ëŒ€í•œ ì˜µì…˜ë¶€ë¶„ì— ì¶”ê°€í•˜ë©´ ëœë‹¤.

ë‹¤ìŒì²˜ëŸ¼  â‡’ required: true , maxLength:30 

**required true ëŠ” title í•„ë“œëŠ” í•„ìˆ˜ ê°’ìœ¼ë¡œ ì„¤ì •í•œë‹¤ëŠ” ëœ»ì´ë‹¤.**

maxLengthëŠ” 30ì ë‚´ë¡œ ê¸€ììˆ˜ë¥¼ ì œí•œí•˜ëŠ” ê²ƒì´ë‹¤.

**ê¸°ë³¸ì ìœ¼ë¡œ  mongoose schema ì— ì •ì˜ë˜ì§€ ì•Šì€ í•„ë“œëŠ” ë”°ë¡œ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.**

**ê³ ë¡œ ì´ìƒí•œ í•„ë“œë¥¼  requset body ë¡œ ë³´ë‚´ë„ ë°˜ì‘ì´ ì—†ë‹¤.**

```jsx
    {
        title : {
            type : String,
            required: true,
            maxLength:30,
        },
        description : {
            type : String,
        },
        isComplete : {
            type : Boolean,
            default : false,
        },
    },
```

## ë²¨ë¦¬ë°ì´ì…˜ ì˜¤ë¥˜  ê´€ë ¨. (ì„œë²„ê°€ ì£½ìŒ)

ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ìƒê¸´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ìœ íš¨í•˜ì§€ì•ŠëŠ”  url ì„ ì„œë²„ë¡œ ì „ë‹¬í•œë‹¤ë“ ê°€..

**try catch ë¬¸ í™œìš© :**  ë¹„ë™ê¸° ì‘ì—…ì¤‘ ì˜¤ë¥˜ê°€ ìƒê²¼ì„ë•Œ error ê°€ ë°œìƒí•˜ëŠ” ìƒí™©ì„ ê³ ë ¤í•˜ê¸° ì•Šê³ 

ì½”ë“œë¥¼ ì§„í–‰í•˜ë©´ error ê°€ ë°œìƒí–ˆì„ë•Œ ì„œë²„ê°€ ì£½ì–´ë²„ë¦¬ëŠ” ì´ìŠˆê°€ ìƒê¸´ë‹¤.

try catch ë¬¸ì„ í™œìš©í•œ ë¹„ë™ê¸° í•¨ìˆ˜ ì¥ì¹˜ë¥¼ ë”°ë¡œ ì‘ì„±.

ë‹¤ìŒì˜ asyncHandler í•¨ìˆ˜ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.

return ê°’ì„ ë‹¤ì‹œ ë¹„ë™ê¸°ë¡œ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ í•¨ìˆ˜ë¥¼ ì‘ë™í•œë‹¤ â‡’ 

**ì´ë•Œ try catch ë¬¸ì„ í™œìš©í•´ì„œ error  ì˜ name í”„ë¡œí¼í‹°ë¡œ ì ‘ê·¼í•˜ì—¬ error ì˜ ì¢…ë¥˜ë¥¼** 

**íŒŒì•…í•˜ê³  ê·¸ì—ë§ëŠ” status ë¥¼ retrun í•´ì¤€ë‹¤.**

**ì—¬ê¸°ì„œ í¬ì¸íŠ¸ asyncHandler í•¨ìˆ˜ë„ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ëŠ” ì´ìœ !**

íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì¤€ í•¨ìˆ˜ê°€ ë¹„ë™ê¸° í•¨ìˆ˜ ì´ê¸°ë•Œë¬¸ì— , ë¬¼ë¡  ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì•„ë‹ˆë”ë¼ë„

ë„˜ê²¨ì¤€ í•¨ìˆ˜ì˜ ê²°ê³¼ ê°’ì„ ê¸°ë‹¤ë¦¬ê³  ê·¸ ê²°ê³¼ê°’ì„ í† ëŒ€ë¡œ try catch ë¬¸ì„ ì‹¤í–‰í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—

2ì¤‘ ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ëª¨ì–‘ì´ ë‚˜ì˜¤ëŠ” ê²ƒì´ë‹¤.

**ë‹¤ìŒí•¨ìˆ˜ì— ëŒ€í•œ ì„¤ëª… â‡’**

asyncHandler ëŠ” ì„œë²„ì— ./tasks ê°™ì€ URL ê²½ë¡œë¡œ ìš”ì²­ë“¤ì´ ë“¤ì–´ì™”ê³  ê·¸ì— ëŒ€í•œ response ì‘ë‹µ

ì„ í•´ì£¼ëŠ” **ë¼ìš°í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ì „ì— ì‹¤í–‰í•˜ëŠ” â€œë¯¸ë“¤ì›¨ì–´â€ê°€ ëœë‹¤.**

ë‹¤ìŒ ì½”ë“œëŠ” ë¼ìš°í„°ë¥¼ ì‹¤í–‰í•˜ê¸°ì „ì— asyncHandler ë¥¼ ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ 

ê·¸ë‹¤ìŒ ë¼ìš°í„°ë¥¼ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰í•˜ê³  ë¼ìš°í„°ì˜ ê²°ê³¼ ê°’ì„ ë°›ì•„ ì˜¤ë¥˜ê°€ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì½”ë“œê°€ ëœë‹¤.

ì¦‰ â‡’ res ë¥¼ ëŒë ¤ì£¼ê¸° ì „ì— ì˜¤ë¥˜ë¥¼ ê²€ì‚¬í•˜ëŠ” ì¥ì¹˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ë‹ˆ **ì´ê²ƒì€ ë¯¸ë“¤ì›¨ì–´ê°€ ëœë‹¤.**

```jsx
function asyncHandler(handler) {
    return async function (req, res) {
        try  {
            await handler(req ,res);
        } catch (error) {
            if(error.name === 'ValidationError') {
                res.status(400).send({message : error.message});
            }else if(error.name === 'CastError'){
                res.status(404).send({message : 'Cannot find given id.'});
            }else{
                res.status(500).send({message : error.message});
            }
        }
    }
}
app.get('/tasks' , asyncHandler( async (req , res) => { 
    const sort = req.query.sort;
    const count = Number(req.query.count) || 0;
    const sortOption = {created : sort === 'oldest' ? 'asc' : 'desc'};
    const tasks = await Task.find().sort(sortOption).limit(count);
    res.send(tasks);
}))
```

## ë°ì´í„°ë² ì´ìŠ¤ ë°ì´í„° ìˆ˜ì •(PATCH),ì‚­ì œ(DELETE)

ë‹¤ìŒPATCH ë¼ìš°íŠ¸ ì—ì„œ ìƒì†Œí•œ ì½”ë“œê°€ ìˆë‹¤.

ë°”ë¡œ **save ( ) í•¨ìˆ˜ì¸ë° â‡’ saveí•¨ìˆ˜ëŠ” ìˆ˜ì •í•˜ê³ ì í•˜ëŠ” ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥** 

í•˜ê¸°ìœ„ì—ì„œ í•„ìš”í•œ í•¨ìˆ˜ì´ë‹¤. 

í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ ìƒˆë¡œìš´ ë¬¸ì„œë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì‚½ì…í•œë‹¤. Task ëª¨ë¸ë¡œ ìƒì„±ëœ ê°ì²´ë¥¼

jsoní˜•ì‹ìœ¼ë¡œâ€¦ mongoDBì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìˆ˜ì •ëœ í•„ë“œë§Œ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•œë‹¤.

**í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ì‹œì ì—ì„œì˜ ìˆ˜ì •ëœ ë°ì´í„°ë¥¼ ë°˜ì˜**

save í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ì•Šìœ¼ë©´ ìˆ˜ì •ëœ ë°ì´í„°ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.

Model.findByIdAndDelete(id) í•¨ìˆ˜

ì´í•¨ìˆ˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ id ë¥¼ ì¡°íšŒí•´ì„œ ì•„ê·œë¨¼íŠ¸ë¡œ ë„˜ê²¨ì¤€ id ê°’ì„ ì°¾ì•„ì„œ

ì‚­ì œí•´ì¤€ë‹¤. ì•„ì£¼ í¸ë¦¬í•œê²ƒ ê°™ë‹¤.

delete ë¼ìš°íŠ¸ì—ì„œëŠ” ë³´í†µ ìƒíƒœì½”ë“œë§Œì„ return í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

ê·¸ëŸ´ë•ŒëŠ” sendStatus ë©”ì†Œë“œë¥¼ í™œìš©í•œë‹¤.

```jsx
app.patch('/tasks/:id' , asyncHandler( async (req , res ) => {
    const id = req.params.id;
    const task = await Task.findById(id);
    if(task) {
    Object.keys(req.body).forEach((el) =>  {
        task[el] = req.body[el];
    });
    await task.save();
    res.send(task);
    } else {
        res.status(404).send({message : "Cannot find given id."})
    }
}))

app.delete('/tasks/:id',asyncHandler( async (req , res) => {
    const id = req.params.id;
    const task = await Task.findByIdAndDelete(id);
    if(task){
        res.sendStatus(204);
    }else{
        res.status(404).send({message: "Cannot find given id."})
    }
}))
```
